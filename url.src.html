<!doctype html>
<html lang=en-US>
<meta charset=utf-8>
<title>URL Standard</title>
<link rel=stylesheet href=http://www.whatwg.org/style/specification>
<link rel=icon href=//resources.whatwg.org/logo-url.svg>

<div class=head>

<p><a class=logo href=//www.whatwg.org/><img alt=WHATWG src=//resources.whatwg.org/logo-url.svg width=100 height=100></a></p>
<h1>URL</h1>
<h2 class="no-num no-toc">Living Standard &mdash; Last Updated [DATE: 01 Jan 1901]</h2>

<dl>
 <dt>This Version:
 <dd><a href=//url.spec.whatwg.org/>http://url.spec.whatwg.org/</a>

 <dt>Participate:</dt>
 <dd>Send feedback to
  <a href="http://www.whatwg.org/mailing-list">whatwg@whatwg.org</a>
  (<a href="http://www.whatwg.org/mailing-list#specs">archives</a>) or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=URL">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=URL&amp;resolution=---">open bugs</a>)
 <dd><a href="http://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href=https://github.com/whatwg/url/commits>https://github.com/whatwg/url/commits</a>
 <dd><a href="https://twitter.com/urlstandard">@urlstandard</a>

 <dt>Editor:
 <dd class="h-card vcard"><a class="u-url url p-name fn" lang="nl" href="http://annevankesteren.nl/">Anne van Kesteren</a>
  &lt;<a class="u-email email" href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>>
</dl>

<script src=//resources.whatwg.org/file-bug.js async></script>

<p class=copyright><a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/80x15.png" alt="CC0"></a>
To the extent possible under law, the editors have waived all copyright and
related or neighboring rights to this work. In addition, as of
[DATE: 01 Jan 1901], the editors have made this specification available
under the
<a rel="license"
href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

</div>



<h2 class="no-num no-toc">Table of Contents</h2>
<!--toc-->



<h2 class=no-num>Goals</h2>

<p>The URL standard sets out to make URLs fully predictable and
interoperable. This is the plan:

<ul>
 <li><p>Align RFC 3986 and RFC 3987 with contemporary implementations and
 obsolete them in the process. (E.g. spaces, other "illegal" code points,
 query encoding, equality, canonicalization, are all concepts not entirely
 shared, or defined.) URL parsing needs to become as solid as HTML parsing.
 <span data-anolis-ref class=informative>URI</span>
 <span data-anolis-ref class=informative>IRI</span>

 <li><p>Standardize on the term URL. URI and IRI are just confusing. In
 practice a single algorithm is used for both so keeping them distinct is
 not helping anyone. URL also easily wins the
 <a href="http://www.googlefight.com/index.php?word1=url&amp;word2=uri">search result popularity contest</a>.

 <li><p>Define URL's existing JavaScript API in full detail and add
 enhancements to make it easier to work with. Add a new <code>URL</code>
 object as well for URL manipulation without usage of HTML elements. (Useful
 for Web Workers.)
</ul>

<p class=note>As the editor learns more about the subject matter the goals
might increase in scope somewhat.



<h2>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>



<h2>Terminology</h2>

<p>Some terms used in this specification are defined in the
Encoding Standard. <span data-anolis-ref>ENCODING</span>

<p>The <dfn>ASCII digits</dfn> are code points in the range U+0030 to U+0039.
<!-- XXX ref Encoding? -->

<p>The <dfn>ASCII hex digits</dfn> are <span>ASCII digits</span> or are
code points in the range U+0041 to U+0046 or in the range U+0061 to U+0066.

<p>The <dfn>ASCII alpha</dfn> are code points in the range U+0041 to U+005A
or in the range U+0061 to U+007A.

<p>The <dfn>ASCII alphanumeric</dfn> are <span>ASCII digits</span> or
<span>ASCII alpha</span>.


<p>The <dfn>domain label separators</dfn> are the code points
U+002E, U+3002, U+FF0E, and U+FF61.
<!-- IDNA2003/UTS #46; IDNA2008 does not define these -->

<h3>Parsers</h3>

<p>The <dfn>EOF code point</dfn> is a conceptual code point that signifies the end of a
string or code point stream.

<p>A <dfn>parse error</dfn> indicates a non-fatal mismatch between input and requirements.
User agents are encouraged to expose <span title="parse error">parse errors</span>
somehow.

<p>Within a parser algorithm that uses a <var title>pointer</var> variable, <dfn>c</dfn>
references the code point the <var title>pointer</var> variable points to.

<p>Within a string-based parser algorithm that uses a <var title>pointer</var> variable,
<dfn>remaining</dfn> references the substring after <var title>pointer</var> in the string
being processed.

<p class=example>If "<code title>mailto:username@example</code>" is a string being
processed and <var title>pointer</var> points to "<code title>@</code>",
<span>c</span> is "<code title>@</code>" and <span>remaining</span> is
"<code title>example</code>".



<h2>Percent-encoded bytes</h2>

<p>A <dfn>percent-encoded byte</dfn> is "<code title>%</code>", followed by
two <span>ASCII hex digits</span>. Sequences of
<span title="percent-encoded byte">percent-encoded bytes</span>, after
conversion to bytes, should not cause
<span data-anolis-spec=encoding>utf-8 decode</span> to run into any
<span data-anolis-spec=encoding title=error>errors</span>.

<p>To <dfn>percent encode</dfn> a <var title>byte</var> into a
<span>percent-encoded byte</span>, return a string consisting of
"<code title>%</code>", followed by a double-digit, uppercase, hexadecimal
representation of <var title>byte</var>.

<p>To <dfn>percent decode</dfn> a <var title>string</var> using code points in the range
U+0000 to U+007F into a byte sequence, run these steps:

<ol>
 <li><p>Let <var title>pointer</var> be a pointer into
 <var title>string</var>, initially zero (pointing to the first code point).

 <li><p>Let <var title>bytes</var> be an empty byte sequence.

 <li>
  <p>While <span>c</span> is not the <span>EOF code point</span>, run
  these substeps:

  <ol>
   <li><p>While <span>c</span> is not "<code title>%</code>" or the
   <span>EOF code point</span>, append to <var title>bytes</var> a byte
   whose value is <span>c</span>'s code point and increase
   <var title>pointer</var> by one.

   <li><p>If <span>c</span> is "<code title>%</code>" and
   <span>remaining</span> does not start with two
   <span>ASCII hex digits</span>, append to <var title>bytes</var> a byte
   whose value is <span>c</span>'s code point, increase
   <var title>pointer</var> by one.

   <li><p>Otherwise, while <span>c</span> is "<code title>%</code>" and
   <span>remaining</span> starts with two <span>ASCII hex digits</span>,
   append to <var title>bytes</var> a byte whose value is
   <span>remaining</span>'s two leading code points, interpreted as
   hexadecimal number, and increase <var title>pointer</var> by three.
  </ol>

 <li>
  <p>Return <var title>bytes</var>.
</ol>

<!-- the escape sets are minimal as escaping can lead to problems; we might
     be able to escape more here but only if implementors are willing and
     there's an upside

     note that query and application/x-www-form-urlencoded use their own
     local sets -->
<p>The <dfn>simple encode set</dfn> are all code points less than
U+0020 (i.e. excluding U+0020) and all code points greater than U+007E.

<p>The <dfn>default encode set</dfn> is the
<span>simple encode set</span> and code points U+0020,
'<code title>"</code>', <!-- 0x22 -->
"<code title>#</code>", <!-- 0x23 -->
"<code title>&lt;</code>", <!-- 0x3C -->
"<code title>></code>", <!-- 0x3E -->
"<code title>?</code>", <!-- 0x3F -->
and
"<code title>`</code>". <!-- 0x60 -->

<p>The <dfn>password encode set</dfn> is the
<span>default encode set</span> and code points
"<code title>/</code>", <!-- 0x2F -->
"<code title>@</code>", <!-- 0x40 -->
and
"<code title>\</code>". <!-- 0x5C -->

<p>The <dfn>username encode set</dfn> is the
<span>password encode set</span> and code point
"<code title>:</code>". <!-- 0x3A -->

<p>To <dfn>utf-8 percent encode</dfn> a <var title>code point</var>, using
an <var title>encode set</var>, run these steps:

<ol>
 <li><p>If <var title>code point</var> is not in
 <var title>encode set</var>, return <var title>code point</var>.

 <li><p>Let <var title>bytes</var> be the result of running
 <span data-anolis-spec=encoding>utf-8 encode</span> on
 <var title>code point</var>.

 <li><p><span>Percent encode</span> each byte in <var title>bytes</var>, and
 then return them concatenated, in the same order.
</ol>



<h2>Hosts (domains and IP addresses)</h2>

<!-- Punycode:
     http://tools.ietf.org/html/rfc3492
     http://mothereff.in/punycode -->

<p>A <dfn title=concept-host>host</dfn> is a string that represents a
network address, either in the form of a
<span title=concept-domain>domain</span> or an
<span title=concept-ipv6>IPv6 address</span>.

<p class=note>This is a slightly more generic definition of
<span title=concept-host>host</span> than its traditional meaning for the
sake of convenience.
<!-- "convenience's sake" as The Economist would write it is ugly -->

<p>A <dfn title=concept-domain>domain</dfn> is an ordered list of one or
more <dfn title=concept-domain-label>domain labels</dfn>.

<p>An <dfn title=concept-ipv6>IPv6 address</dfn> is a 128-bit identifier and
for the purposes of this specification represented as an ordered list of
eight <dfn title=concept-ipv6-piece>16-bit pieces</dfn>.
<span data-anolis-ref class=informative>IPV6</span>


<h3>IDNA</h3>

<p>The <dfn title=concept-domain-label-to-ascii>domain label to ASCII</dfn> algorithm is
the <span data-anolis-spec=idna title=ToASCII>IDNA2003 ToASCII algorithm</span> with the
AllowUnassigned flag set and the version of Unicode used being the most recent version
rather than Unicode 3.2.

<p>The <dfn title=concept-domain-label-to-unicode>domain label to Unicode</dfn> algorithm
is the <span data-anolis-spec=idna title=ToUnicode>IDNA2003 ToUnicode algorithm</span>
with the AllowUnassigned flag set and the version of Unicode used being the most recent
version rather than Unicode 3.2.
<span data-anolis-ref>IDNA</span>
<span data-anolis-ref>UNICODE</span>

<p class=note>Using the latest version of Unicode as well as IDNA2003 rather than IDNA2008
are willful violations, to be compatible with widely deployed clients.

<p>The <dfn title=concept-domain-to-ascii>domain to ASCII</dfn> algorithm takes a
<span title=concept-domain>domain</span> <var title>input</var> and then runs these steps:

<ol>
 <li><p>Let <var title>asciiLabels</var> be an empty list.

 <li><p>On each <span title=concept-domain-label>domain label</span> in
 <var title>input</var>, in order, run the
 <span title=concept-domain-label-to-ascii>domain label to ASCII</span> algorithm.
 If that operation failed, return failure.
 Otherwise, append the result to <var title>asciiLabels</var>.

 <li><p>Return <var title>asciiLabels</var>.
</ol>

<p>The <dfn title=concept-domain-to-unicode>domain to Unicode</dfn> algorithm takes a
<span title=concept-domain>domain</span> <var title>input</var> and then runs these steps:

<ol>
 <li><p>Let <var title>unicodeLabels</var> be an empty list.

 <li>
  <p>On each <span title=concept-domain-label>domain label</span> in
  <var title>input</var>, in order, run the
  <span title=concept-domain-label-to-unicode>domain label to Unicode</span> algorithm and
  append the result to <var title>unicodeLabels</var>.

  <p class=note>Note that the
  <span title=concept-domain-label-to-unicode>domain label to Unicode</span> algorithm
  cannot fail.

 <li><p>Return <var title>unicodeLabels</var>.
</ol>



<h3 id=host-writing>Writing</h3>

<p>A <span title=concept-host>host</span> must be either a
<span title=concept-domain>domain</span> or "<code title>[</code>", followed
by an <span title=concept-ipv6>IPv6 address</span>, followed by
"<code title>]</code>".

<p>A <span title=concept-domain>domain</span> is one or more
<span title=concept-domain-label>domain labels</span> separated from each
other by a
<span title="domain label separators">domain label separator</span>,
optionally followed by a
<span title="domain label separators">domain label separator</span>.

<p class=note>A trailing
<span title="domain label separators">domain label separator</span>
signifies an empty <span title=concept-domain-label>domain label</span>.
<!-- if a domain has 4 labels, no trailing dot, and each label consists only
     of ASCII digits it's IPv4 because the last label of a domain cannot
     start with an ASCII digit -->

<p class=XXX>A <span title=concept-domain-label>domain label</span> is ...

<p>An <span title=concept-ipv6>IPv6 address</span> is defined in the
<a href="http://tools.ietf.org/html/rfc4291#section-2.2">"Text Representation of Addresses" chapter of IP Version 6 Addressing Architecture</a>.
<span data-anolis-ref>IPV6</span>
<!-- http://tools.ietf.org/html/rfc5952 updates that RFC, but it seems as
     far as what developers can do we should be liberal

     XXX should we define the format inline instead just like STD 66? -->


<h3 id=host-parsing>Parsing</h3>

<p>The <dfn title=concept-host-parser>host parser</dfn> takes a string
<var title>input</var> and then runs these steps:

<ol>
 <li><p>If <var title>input</var> is the empty string, return failure.
 <!-- Otherwise parsing URLs would not be idempotent:

      http://@/example.org/ -> http:///example.org/ -> http://example.org/

      Could potentially move this check to the URL parser if deemed problematic. -->

 <li>
  <p>If <var title>input</var> starts with "<code title>[</code>", run these
  substeps:

  <ol>
   <li><p>If <var title>input</var> does not end with
   "<code title>]</code>", <span>parse error</span>, return failure.

   <li><p>Return the result of
   <span title=concept-ipv6-parser>parsing</span> <var title>input</var>
   with its leading "<code title>[</code>" and trailing
   "<code title>]</code>" removed.
  </ol>

 <li><p>Let <var title>host</var> be the result of running
 <span data-anolis-spec=encoding>utf-8</span>'s
 <span data-anolis-spec=encoding>decoder</span> on the
 <span title="percent decode">percent decoding</span> of
 <var title>input</var>.

 <li><p>Let <var title>domain</var> be the result of splitting <var title>host</var> on
 any <span>domain label separators</span>.

 <li>
  <p>Return the result of running
  <span title=concept-domain-to-ascii>domain to ASCII</span> on <var title>domain</var>.

  <p class=note><span title=concept-domain-to-ascii>Domain to ASCII</span> can return
  failure in which case the <span title=concept-host-parser>host parser</span> would
  return failure here.
</ol>

<p>The <dfn title=concept-ipv6-parser>IPv6 parser</dfn> takes a string
<var title>input</var> and then runs these steps:

<ol>
 <li><p>Let <var title>address</var> be a new
 <span title=concept-ipv6>IPv6 address</span> with its
 <span title=concept-ipv6-piece>16-bit pieces</span> initialized to 0.

 <li><p>Let <var title>piece pointer</var> be a pointer into
 <var title>address</var>'s
 <span title=concept-ipv6-piece>16-bit pieces</span>, initially zero
 (pointing to the first <span title=concept-ipv6-piece>16-bit piece</span>),
 and let <var title>piece</var> be the
 <span title=concept-ipv6-piece>16-bit piece</span> it points to.

 <li><p>Let <var title>compress pointer</var> be another pointer into
 <var title>pieces</var>, initially null and pointing to nothing.

 <li><p>Let <var title>pointer</var> be a pointer into
 <var title>input</var>, initially zero (pointing to the first code point).

 <li>
  <p>If <span>c</span> is "<code title>:</code>", run these substeps:

  <ol>
   <li><p>If <span>remaining</span> does not start with
   "<code title>:</code>", <span>parse error</span>, return failure.

   <li><p>Increase <var title>pointer</var> by two.

   <li><p>Increase <var title>piece pointer</var> by one and then set
   <var title>compress pointer</var> to <var title>piece pointer</var>.
  </ol>

 <li>
  <p><dfn title=concept-ipv6-parser-main>Main</dfn>:
  While <span>c</span> is not the <span>EOF code point</span>, run these
  substeps:

  <ol>
   <li><p>If <var title>piece pointer</var> is eight,
   <span>parse error</span>, return failure.

   <li>
    <p>If <span>c</span> is "<code title>:</code>", run these inner
    substeps:

    <ol>
     <li><p>If <var title>compress pointer</var> is not null,
     <span>parse error</span>, return failure.

     <li>Increase <var title>pointer</var> and <var title>piece pointer</var> by one, set
     <var title>compress pointer</var> to <var title>piece pointer</var>,
     and then jump to <span title=concept-ipv6-parser-main>Main</span>.
    </ol>

   <li><p>Let <var title>value</var> and <var title>length</var> be 0.

   <li><p>While <var title>length</var> is less than 4 and
   <span>c</span> is an
   <span title="ASCII hex digits">ASCII hex digit</span>, set
   <var title>value</var> to
   <var title>value</var> &times; 0x10 + <span>c</span> interpreted as hexadecimal number,
   and increase <var title>pointer</var> and <var title>length</var> by one.

   <li>
    <p>Based on <span>c</span>:

    <dl class=switch>
     <dt>"<code title>.</code>"
     <dd>
      <p>If <var title>length</var> is 0, <span>parse error</span>,
      return failure.
      <p>Decrease <var title>pointer</var> by <var title>length</var>.
      <p>Jump to <span title=concept-ipv6-parser-ipv4>IPv4</span>.

     <dt>"<code title>:</code>"
     <dd>
      <p>Increase <var title>pointer</var> by one.
      <p>If <span>c</span> is the <span>EOF code point</span>,
      <span>parse error</span>, return failure.

     <dt>Anything but the <span>EOF code point</span>
     <dd><p><span>Parse error</span>, return failure.
    </dl>

   <li><p>Set <var title>piece</var> to <var title>value</var>.

   <li><p>Increase <var title>piece pointer</var> by one.
  </ol>

 <li><p>If <span>c</span> is the <span>EOF code point</span>, jump to
 <span title=concept-ipv6-parser-finale>Finale</span>.

 <li><p><dfn title=concept-ipv6-parser-ipv4>IPv4</dfn>:
 If <var title>piece pointer</var> is greater than six,
 <span>parse error</span>, return failure.

 <li><p>Let <var title>dots seen</var> be 0.

 <li>
  <p>While <span>c</span> is not the <span>EOF code point</span>, run
  these substeps:

  <ol>
   <li><p>Let <var title>value</var> be 0.

   <li><p>While <span>c</span> is an
   <span title="ASCII digits">ASCII digit</span>, set <var title>value</var> to
   <var title>value</var> &times; 10 + <span>c</span> interpreted as decimal number
   and increase <var title>pointer</var> by one.

   <li><p>If <var title>value</var> is greater than 255,
   <span>parse error</span>, return failure.

   <li><p>If <var title>dots seen</var> is less than 3 and
   <span>c</span> is not a "<code title>.</code>",
   <span>parse error</span>, return failure.

   <li><p>If <var title>dots seen</var> is 3 and <span>c</span> is not
   the <span>EOF code point</span>,
   <span>parse error</span>, return failure.

   <li><p>Set <var title>piece</var> to
   <var title>piece</var> &times; 0x100 + <var title>value</var>.

   <li><p>If <var title>dots seen</var> is 0 or 2, increase
   <var title>piece pointer</var> by one.

   <li><p>Increase <var title>dots seen</var> by one.
  </ol>

 <li>
  <p><dfn title=concept-ipv6-parser-finale>Finale</dfn>:
  If <var title>compress pointer</var> is not null, run these substeps:

  <ol>
   <li><p>Let <var title>swaps</var> be
   <var title>piece pointer</var> &minus; <var title>compress pointer</var>.

   <li><p>Set <var title>piece pointer</var> to seven.

   <li><p>While neither <var title>piece pointer</var> nor
   <var title>swaps</var> is zero, swap <var title>piece</var> with the
   <span title=concept-ipv6-piece>piece</span> at pointer
   <var title>compress pointer</var> + <var title>swaps</var> &minus; 1, and then
   decrease <var title>piece pointer</var> and <var title>swaps</var> by
   one.
  </ol>

 <li><p>Otherwise, if <var title>compress pointer</var> is null and
 <var title>piece pointer</var> is not eight, <span>parse error</span>,
 return failure.

 <li><p>Return <var title>address</var>.
</ol>


<h3 id=host-serializing>Serializing</h3>

<p>The <dfn title=concept-host-serializer>host serializer</dfn> takes a
<span title=concept-host>host</span> <var title>host</var> and then runs
these steps:

<ol>
 <li><p>If <var title>host</var> is null, return the empty string.
 <!-- XXX Are we okay with this? -->

 <li><p>If <var title>host</var> is an
 <span title=concept-ipv6>IPv6 address</span>, return
 "<code title>[</code>", followed by the result of running the
 <span title=concept-ipv6-serializer>IPv6 serializer</span> on <var title>host</var>,
 followed by "<code title>]</code>".

 <li><p>Otherwise, <var title>host</var> is a <span title=concept-domain>domain</span>,
 return its <span title=concept-domain-labels>labels</span> separated from each other by
 U+002E.
</ol>

<p>The <dfn title=concept-ipv6-serializer>IPv6 serializer</dfn> takes an
<span title=concept-ipv6>IPv6 address</span> <var title>address</var> and
then runs these steps:

<ol>
 <li><p>Let <var title>output</var> be the empty string.

 <li>
  <p>Let <var title>compress pointer</var> be a pointer to the first
  <span title=concept-ipv6-piece>16-bit piece</span> in the first longest
  sequences of <var title>address</var>'s
  <span title=concept-ipv6-piece>16-bit pieces</span> that are 0.

  <p class=example>In <code title>0:f:0:0:f:f:0:0</code> it would point to
  the second 0.

 <li><p>If there is no sequence of <var title>address</var>'s
 <span title=concept-ipv6-piece>16-bit pieces</span> that are 0 longer than
 one, set <var title>compress pointer</var> to null.

 <li>
  <p>For each <var title>piece</var> in <var title>address</var>'s
  <span title=concept-ipv6-piece>pieces</span>, run these substeps:

  <ol>
   <li><p>If <var title>compress pointer</var> points to
   <var title>piece</var>, append "<code title>::</code>" to
   <var title>output</var> if <var title>piece</var> is
   <var title>address</var>'s first <span title=concept-ipv6-piece>piece</span> and append
   "<code title>:</code>" otherwise, and then run these substeps again with all
   subsequent <span title=concept-ipv6-piece>pieces</span> in
   <var title>address</var>'s <span title=concept-ipv6-piece>pieces</span>
   that are 0 skipped or go the next step in the overall set of steps if
   that leaves no <span title=concept-ipv6-piece>pieces</span>.

   <li><p>Append <var title>piece</var>, represented as the shortest
   possible lowercase hexadecimal number, to <var title>output</var>.

   <li><p>If <var title>piece</var> is not
   <var title>address</var>'s last <span title=concept-ipv6-piece>piece</span>,
   append "<code title>:</code>" to <var title>output</var>.
  </ol>

 <li><p>Return <var title>output</var>.
</ol>

<p class=note>This algorithm requires the recommendation from
A Recommendation for IPv6 Address Text Representation.
<span data-anolis-ref class=informative>IPV6TEXT</span>

<!-- Safari/Gecko/Opera do not normalize IPv6. Chrome does. This algorithm
     follows Chrome because we normalize domains too. -->



<h2>URLs</h2>

<!-- History behind URL as term:
     http://lists.w3.org/Archives/Public/uri/2012Oct/0080.html -->

<p>A <dfn title=concept-url>URL</dfn> is a string that represents an
identifier.

<p>A <span title=concept-url>URL</span> is either a
<span title=concept-relative-url>relative URL</span> or an
<span title=concept-absolute-url>absolute URL</span>. Either form can be
followed by a <span title=concept-url-fragment>fragment</span>.

<p>A <dfn title=concept-relative-url>relative URL</dfn> is a
<span title=concept-url>URL</span> without a <span title=concept-url-scheme>scheme</span>.
A <span title=concept-relative-url>relative URL</span> must be relative
to a <span title=concept-base-url>base URL</span>.

<p>An <dfn title=concept-absolute-url>absolute URL</dfn> is a
<span title=concept-url>URL</span> with a <span title=concept-url-scheme>scheme</span>.

<p>A <dfn title=concept-base-url>base URL</dfn> is an
<span title=concept-absolute-url>absolute URL</span> with a <span>relative scheme</span>.

<p><span title=concept-url-parser>Parsing</span> (provided it does not
return failure) and <span title=concept-url-serializer>serializing</span> a
<span title=concept-url>URL</span> will turn it into an
<span title=concept-absolute-url>absolute URL</span>. The intermediate form
is named a <dfn title=concept-parsed-url>parsed URL</dfn>. The components a
<span title=concept-url>URL</span> can consist of, and a
<span title=concept-parsed-url>parsed URL</span> consists of, are
<dfn title=concept-url-scheme>scheme</dfn>,
<dfn title=concept-url-scheme-data>scheme data</dfn> (not used if
<span title=concept-url-scheme>scheme</span> is a <span>relative scheme</span>),
<dfn title=concept-url-username>username</dfn>,
<dfn title=concept-url-password>password</dfn>,
<dfn title=concept-url-host>host</dfn>,
<dfn title=concept-url-port>port</dfn>,
<dfn title=concept-url-path>path</dfn>,
<dfn title=concept-url-query>query</dfn>, and
<dfn title=concept-url-fragment>fragment</dfn>.

<p>A <dfn>relative scheme</dfn> is a
<span title=concept-url-scheme>scheme</span> listed in the first column of
the following table. A <dfn>default port</dfn> is a
<span>relative scheme</span>'s optional corresponding
<span title=concept-url-port>port</span> and is listed in the second column
on the same row.

<table>
 <tr><th><span title=concept-url-scheme>scheme</span>
     <th><span title=concept-url-port>port</span>
 <tr><td>"<code title>ftp</code>"<td>"<code title>21</code>"
 <tr><td>"<code title>file</code>"<td>
 <tr><td>"<code title>gopher</code>"<td>"<code title>70</code>"
 <tr><td>"<code title>http</code>"<td>"<code title>80</code>"
 <tr><td>"<code title>https</code>"<td>"<code title>443</code>"
 <tr><td>"<code title>ws</code>"<td>"<code title>80</code>"
 <tr><td>"<code title>wss</code>"<td>"<code title>443</code>"
</table>

<!-- The best reason I have for listing "gopher" is Google does it too:
     https://code.google.com/p/google-url/source/browse/trunk/src/url_canon_stdurl.cc#120

     It seems fine to remain compatible on that front, no need to support it
     elsewhere though. -->


<h3>Writing</h3>

<!-- http://tantek.com/2011/238/b1/many-ways-slice-url-name-pieces -->

<p>A <span title=concept-url>URL</span> must be either a
<span title=concept-relative-url>relative URL</span> or an
<span title=concept-absolute-url>absolute URL</span>, optionally followed by
"<code title>#</code>" and a
<span title=concept-url-fragment>fragment</span>.

<p>An <span title=concept-absolute-url>absolute URL</span> must be a
<span title=concept-url-scheme>scheme</span>, followed by
"<code title>:</code>", followed by
<span title=concept-url-scheme-data>scheme data</span>, optionally followed
by "<code title>?</code>" and a <span title=concept-url-query>query</span>.

<p>A <span title=concept-url-scheme>scheme</span> must be one
<span>ASCII alpha</span>, followed by zero or more of
<span>ASCII alphanumeric</span>, "<code title>+</code>",
"<code title>-</code>", and "<code title>.</code>". A
<span title=concept-url-scheme>scheme</span> must be registered
<span class=XXX>...</span>.

<p>The syntax of <span title=concept-url-scheme-data>scheme data</span>
depends on the <span title=concept-url-scheme>scheme</span> and is typically
defined alongside it. For a <span>relative scheme</span>,
<span title=concept-url-scheme-data>scheme data</span> must be a
<span title=concept-scheme-relative-url>scheme-relative URL</span>. For
other <span title=concept-url-scheme>schemes</span>, specifications or
standards must define <span title=concept-url-scheme-data>scheme data</span>
within the constraints of zero or more <span>URL units</span>.

<p>A <span title=concept-relative-url>relative URL</span> must be either a
<span title=concept-scheme-relative-url>scheme-relative URL</span>, an
<span title=concept-absolute-path-relative-url>absolute-path-relative URL</span>,
or a <span title=concept-path-relative-url>path-relative URL</span> that
does not start with a <span title=concept-url-scheme>scheme</span> and
"<code title>:</code>", optionally followed by a "<code title>?</code>" and
a <span title=concept-url-query>query</span>.

<p>A <dfn title=concept-scheme-relative-url>scheme-relative URL</dfn> must be
"<code title>//</code>", optionally followed by
<span title=concept-url-userinfo>userinfo</span> and "<code title>@</code>",
followed by a <span title=concept-host>host</span>, optionally followed
by "<code title>:</code>" and a <span title=concept-url-port>port</span>,
optionally followed by an
<span title=concept-absolute-path-relative-url>absolute-path-relative URL</span>.

<p><dfn title=concept-url-userinfo>Userinfo</dfn> must be a
<span title=concept-url-username>username</span>, optionally followed by a
"<code title>:</code>" and a
<span title=concept-url-password>password</span>.

<p>A <span title=concept-url-username>username</span> must be zero or more
<span>URL units</span>, excluding "<code title>/</code>",
"<code title>:</code>, "<code title>?</code>", and "<code title>@</code>".
<!-- password without ":" (sorted on ASCII position) -->

<p>A <span title=concept-url-password>password</span> must be zero or more
<span>URL units</span>, excluding "<code title>/</code>",
"<code title>?</code>", and "<code title>@</code>".

<p>A <span title=concept-url-port>port</span> must be zero or more
<span>ASCII digits</span>.

<p>An
<dfn title=concept-absolute-path-relative-url>absolute-path-relative URL</dfn>
must be "<code title>/</code>", followed by a
<span title=concept-path-relative-url>path-relative URL</span> that does not
start with "<code title>/</code>".

<p>A <dfn title=concept-path-relative-url>path-relative URL</dfn> must be zero or
more <span title="path segment">path segments</span> separated from each
other by a "<code title>/</code>".

<p>A <dfn>path segment</dfn> must be zero or more <span>URL units</span>,
excluding "<code title>/</code>" and "<code title>?</code>".

<p>A <span title=concept-url-query>query</span> must be zero or more
<span>URL units</span>.

<p>A <span title=concept-url-fragment>fragment</span> must be zero or more
<span>URL units</span>.

<p>The <dfn>URL code points</dfn> are <span>ASCII alphanumeric</span>,
"<code title>!</code>",<!-- 0x21, sub-delims -->
"<code title>$</code>",<!-- 0x24, sub-delims -->
"<code title>&</code>",<!-- 0x26, sub-delims -->
"<code title>'</code>",<!-- 0x27, sub-delims -->
"<code title>(</code>",<!-- 0x28, sub-delims -->
"<code title>)</code>",<!-- 0x29, sub-delims -->
"<code title>*</code>",<!-- 0x2A, sub-delims -->
"<code title>+</code>",<!-- 0x2B, sub-delims -->
"<code title>,</code>",<!-- 0x2C, sub-delims -->
"<code title>-</code>",<!-- 0x2D, iunreserved -->
"<code title>.</code>",<!-- 0x2E, iunreserved -->
"<code title>/</code>",<!-- 0x2F, iquery/ifragment -->
"<code title>:</code>",<!-- 0x3A, ipchar -->
"<code title>;</code>",<!-- 0x3B, sub-delims -->
"<code title>=</code>",<!-- 0x3D, sub-delims -->
"<code title>?</code>",<!-- 0x3F, iquery/ifragment -->
"<code title>@</code>",<!-- 0x40, ipchar -->
"<code title>_</code>",<!-- 0x5F, iunreserved -->
"<code title>~</code>",<!-- 0x7E, iunreserved -->
and code points in the ranges
U+00A0 to U+D7FF,
U+E000 to <!--U+F8FF,
U+F900 to -->U+FDCF,
U+FDF0 to U+FFEF,
U+10000 to U+1FFFD,
U+20000 to U+2FFFD,
U+30000 to U+3FFFD,
U+40000 to U+4FFFD,
U+50000 to U+5FFFD,
U+60000 to U+6FFFD,
U+70000 to U+7FFFD,
U+80000 to U+8FFFD,
U+90000 to U+9FFFD,
U+A0000 to U+AFFFD,
U+B0000 to U+BFFFD,
U+C0000 to U+CFFFD,
U+D0000 to U+DFFFD,
U+E1000 to U+EFFFD,
U+F0000 to U+FFFFD,
U+100000 to U+10FFFD.
<!-- XXX https://www.w3.org/Bugs/Public/show_bug.cgi?id=19743 -->

<p class=note>Code points higher than U+009F will be converted to
<span title="percent-encoded byte">percent-encoded bytes</span> by the
<span title=concept-url-parser>URL parser</span>.

<p>The <dfn>URL units</dfn> are <span>URL code points</span> and
<span title="percent-encoded byte">percent-encoded bytes</span>.



<h3>Parsing</h3>

<p>Aside from the components mentioned earlier, a
<span title=concept-parsed-url>parsed URL</span> also has an associated
<dfn>relative flag</dfn>.

<p class=note>The <span>relative flag</span> exists as checking if a
<span title=concept-parsed-url>parsed URL</span>'s
<span title=concept-url-scheme>scheme</span> is a <span>relative scheme</span> can give
incorrect results due to the <code title=dom-URL-protocol>protocol</code> attribute.
<!-- XXX maybe disallow setting protocol to non-sensical values -->

<p class=XXX>Add the ability to halt on the first conformance error.

<p>The <dfn title=concept-url-parser>URL parser</dfn> takes a string
<var title>input</var>, optionally with a
<span title=concept-base-url>base URL</span> <var title>base</var>,
optionally with an <span data-anolis-spec=encoding>encoding</span>
<var title>encoding override</var>, optionally with an
<span title=concept-parsed-url>parsed URL</span> <var title>url</var> and a state override
<var title>state override</var>, and then runs these steps:

<p class=note>The <var title>encoding override</var> argument is a legacy concept only
relevant for HTML. The <var title>url</var> and <var title>state override</var> arguments
are only for use by methods of objects implementing the <code>URLUtils</code> interface.
<span class=informative data-anolis-ref>HTML</span>

<ol>
 <li>
  <p>If <var title>url</var> is not given:

  <ol>
   <li><p>Set <var title>url</var> to a new
   <span title=concept-parsed-url>parsed URL</span>.

   <li><p>Set <var title>url</var>'s <span title=concept-url-scheme>scheme</span>,
   <span title=concept-url-scheme-data>scheme data</span>,
   <span title=concept-url-username>username</span>, and
   <span title=concept-url-port>port</span> to the empty string,
   <span title=concept-url-password>password</span>,
   <span title=concept-url-host>host</span>,
   <span title=concept-url-query>query</span>, and
   <span title=concept-url-fragment>fragment</span> to null,
   <span title=concept-url-path>path</span> to the empty list, and unset its
   <span>relative flag</span>.

   <li><p>Remove any leading and trailing
   <span data-anolis-spec=encoding>ASCII whitespace</span> from
   <var title>input</var>.
  </ol>

 <li><p>Let <var title>state</var> be <var title>state override</var>
 if given, or <span>scheme start state</span> otherwise.

 <li><p>If <var title>base</var> is not given, set it to null.

 <li><p>If <var title>encoding override</var> is not given, set it to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Let <var title>buffer</var> be the empty string.

 <li><p>Let the <var title>@ flag</var> and the <var title>[] flag</var> be
 unset.

 <li><p>Let <var title>pointer</var> be a pointer to first code point in
 <var title>input</var>.

 <li>
  <p>Keep running the following state machine by switching on
  <var title>state</var>, increasing <var title>pointer</var> by one after
  each time it is run, as long as <var title>pointer</var> does not point
  past the end of <var title>input</var>.

  <dl class=switch>
   <dt><dfn>scheme start state</dfn>
   <dd>
    <ol>
     <li><p>If <span>c</span> is an <span>ASCII alpha</span>,
     append <span>c</span>, lowercased, to <var title>buffer</var>, and
     set <var title>state</var> to <span>scheme state</span>.

     <li><p>Otherwise, if <var title>state override</var> is not given, set
     <var title>state</var> to <span>no scheme state</span>, and decrease
     <var title>pointer</var> by one.

     <li><p>Otherwise, <span>parse error</span>, terminate this algorithm.
    </ol>

   <dt><dfn>scheme state</dfn>
   <dd>
    <ol>
     <li><p>If <span>c</span> is an <span>ASCII alphanumeric</span>,
     "<code title>+</code>", "<code title>-</code>", or
     "<code title>.</code>", append <span>c</span>, lowercased, to
     <var title>buffer</var>.

     <li>
      <p>Otherwise, if <span>c</span> is "<code title>:</code>", set
      <var title>url</var>'s <span title=concept-url-scheme>scheme</span> to
      <var title>buffer</var>, <var title>buffer</var> to the empty string,
      and then run these substeps:

      <ol>
       <li><p>If <var title>state override</var> is given,
       terminate this algorithm.

       <li><p>If <var title>url</var>'s
       <span title=concept-url-scheme>scheme</span> is
       a <span>relative scheme</span>, set <var title>url</var>'s
       <span>relative flag</span>.

       <li><p>If <var title>url</var>'s
       <span title=concept-url-scheme>scheme</span> is
       "<code title>file</code>", set <var title>state</var> to
       <span>relative state</span>.

       <li><p>Otherwise, if <var title>url</var>'s
       <span>relative flag</span> is set, <var title>base</var> is not null
       and <var title>base</var>'s
       <span title=concept-url-scheme>scheme</span> is equal to
       <var title>url</var>'s <span title=concept-url-scheme>scheme</span>,
       set <var title>state</var> to
       <span>relative or authority state</span>.

       <li><p>Otherwise, if <var title>url</var>'s
       <span>relative flag</span> is set, set <var title>state</var> to
       <span>authority first slash state</span>.

       <li><p>Otherwise, set <var title>state</var> to
       <span>scheme data state</span>.
      </ol>

     <li><p>Otherwise, if <var title>state override</var> is not given, set
     <var title>buffer</var> to the empty string, <var title>state</var> to
     <span>no scheme state</span>, and start over (from the first code point
     in <var title>input</var>).

     <li><p>Otherwise, if <span>c</span> is the
     <span>EOF code point</span>, terminate this algorithm.
     <!-- account for URL.protocol = "test" -->

     <li><p>Otherwise, <span>parse error</span>, terminate this algorithm.
    </ol>

   <dt><dfn>scheme data state</dfn>
   <dd>
    <ol>
     <li><p>If <span>c</span> is "<code title>?</code>", set
     <var title>url</var>'s <span title=concept-url-query>query</span>
     to the empty string and <var title>state</var> to
     <span>query state</span>.

     <li><p>Otherwise, if <span>c</span> is "<code title>#</code>", set
     <var title>url</var>'s <span title=concept-url-fragment>fragment</span>
     to the empty string and <var title>state</var> to
     <span>fragment state</span>.

     <li>
      <p>Otherwise, run these substeps:

      <ol>
       <li><p>If <span>c</span> is not the <span>EOF code point</span>, not a
       <span title="URL code points">URL code point</span>, and not
       "<code title>%</code>", <span>parse error</span>.

       <li><p>If <span>c</span> is "<code title>%</code>" and <span>remaining</span> does
       not start with two <span>ASCII hex digits</span>, <span>parse error</span>.

       <li><p>If <span>c</span> is none of
       <span>EOF code point</span>, U+0009, U+000A, and U+000D,
       <span>utf-8 percent encode</span> <span>c</span> using the
       <span>simple encode set</span>, and append the result to
       <var title>url</var>'s
       <span title=concept-url-scheme-data>scheme data</span>.
      </ol>
    </ol>

   <dt><dfn>no scheme state</dfn>
   <dd>
    <p>If <var title>base</var> is null, or <var title>base</var>'s
    <span title=concept-url-scheme>scheme</span> is not a
    <span>relative scheme</span>, <span>parse error</span>, return failure.

    <p class=note>Due to the <code title=dom-URL-protocol>protocol</code> attribute's
    ability to change <var title>base</var>'s
    <span title=concept-url-scheme>scheme</span>, <var title>base</var>'s
    <span>relative flag</span> is not used here.

    <p>Otherwise, set <var title>state</var> to <span>relative state</span>,
    and decrease <var title>pointer</var> by one.

   <dt><dfn>relative or authority state</dfn>
   <dd>
    <p>If <span>c</span> is "<code>/</code>" and
    <span>remaining</span> starts with "<code>/</code>", set
    <var title>state</var> to <span>authority ignore slashes state</span>
    and increase <var title>pointer</var> by one.

    <p>Otherwise, <span>parse error</span>, set <var title>state</var> to
    <span>relative state</span> and decrease <var title>pointer</var> by
    one.

   <dt><dfn>relative state</dfn>
   <dd>
    <p>Set <var title>url</var>'s <span>relative flag</span>, set
    <var title>url</var>'s <span title=concept-url-scheme>scheme</span> to
    <var title>base</var>'s <span title=concept-url-scheme>scheme</span> if
    <var title>url</var>'s <span title=concept-url-scheme>scheme</span> is not
    "<code title>file</code>", and then, based on <span>c</span>:

    <dl class=switch>
     <dt><span>EOF code point</span>
     <dd>
      <p>Set <var title>url</var>'s <span title=concept-url-host>host</span>
      to <var title>base</var>'s <span title=concept-url-host>host</span>,
      <var title>url</var>'s <span title=concept-url-port>port</span> to
      <var title>base</var>'s <span title=concept-url-port>port</span>,
      <var title>url</var>'s <span title=concept-url-path>path</span> to
      <var title>base</var>'s <span title=concept-url-path>path</span>, and
      <var title>url</var>'s <span title=concept-url-query>query</span> to
      <var title>base</var>'s <span title=concept-url-query>query</span>.

     <dt>"<code title>/</code>"
     <dt>"<code title>\</code>"
     <dd>
      <ol>
       <li><p>If <span>c</span> is "<code title>\</code>",
       <span>parse error</span>.
       <li><p>Set <var title>state</var> to
       <span>relative slash state</span>.
      </ol>

     <dt>"<code title>?</code>"
     <dd><p>Set
     <var title>url</var>'s <span title=concept-url-host>host</span> to
     <var title>base</var>'s <span title=concept-url-host>host</span>,
     <var title>url</var>'s <span title=concept-url-port>port</span> to
     <var title>base</var>'s <span title=concept-url-port>port</span>,
     <var title>url</var>'s <span title=concept-url-path>path</span> to
     <var title>base</var>'s <span title=concept-url-path>path</span>,
     <var title>url</var>'s <span title=concept-url-query>query</span> to the empty string,
     and <var title>state</var> to <span>query state</span>.

     <dt>"<code title>#</code>"
     <dd><p>Set
     <var title>url</var>'s <span title=concept-url-host>host</span> to
     <var title>base</var>'s <span title=concept-url-host>host</span>,
     <var title>url</var>'s <span title=concept-url-port>port</span> to
     <var title>base</var>'s <span title=concept-url-port>port</span>,
     <var title>url</var>'s <span title=concept-url-path>path</span> to
     <var title>base</var>'s <span title=concept-url-path>path</span>,
     <var title>url</var>'s <span title=concept-url-query>query</span> to
     <var title>base</var>'s <span title=concept-url-query>query</span>,
     <var title>url</var>'s <span title=concept-url-fragment>fragment</span> to the empty string,
     and <var title>state</var> to <span>fragment state</span>.

     <dt>Otherwise
     <dd>
      <ol>
       <li>
        <p>If <var title>url</var>'s <span title=concept-url-scheme>scheme</span> is not
        "<code title>file</code>", or <var title>c</var> is not an
        <span>ASCII alpha</span>, or <span>remaining</span> does not start with either
        "<code title>:</code>" or "<code title>|</code>", or <span>remaining</span> does
        not consist of one code point, or <span>remaining</span>'s second code point is
        not one of "<code title>/</code>", "<code title>\</code>", "<code title>?</code>",
        and "<code title>#</code>", then set
        <var title>url</var>'s <span title=concept-url-host>host</span> to
        <var title>base</var>'s <span title=concept-url-host>host</span>,
        <var title>url</var>'s <span title=concept-url-port>port</span> to
        <var title>base</var>'s <span title=concept-url-port>port</span>,
        <var title>url</var>'s <span title=concept-url-path>path</span> to
        <var title>base</var>'s <span title=concept-url-path>path</span>, and then pop
        <var title>url</var>'s <span title=concept-url-path>path</span>.
        <!-- base's path cannot be empty so pop does not need a non-empty check -->

        <p class=note>This is a (platform-independent) Windows drive letter quirk.
        When found at the start of a <code title>file</code> URL it is treated as an
        absolute path rather than one relative to
        <var title>base</var>'s <span title=concept-url-path>path</span>.

       <li><p>Set <var title>state</var> to <span>relative path state</span>,
       and decrease <var title>pointer</var> by one.
      </ol>
    </dl>

   <dt><dfn>relative slash state</dfn>
   <dd>
    <p>If <span>c</span> is either "<code title>/</code>" or
    "<code title>\</code>", run these steps:

    <ol>
     <li><p>If <span>c</span> is "<code title>\</code>",
     <span>parse error</span>.

     <li><p>If <var title>url</var>'s
     <span title=concept-url-scheme>scheme</span> is
     "<code title>file</code>", set <var title>state</var> to
     <span>file host state</span>.

     <li><p>Otherwise, set <var title>state</var> to
     <span>authority ignore slashes state</span>.
    </ol>

    <p>Otherwise, run these steps:

    <ol>
     <li>
      <p>If <var title>url</var>'s <span title=concept-url-scheme>scheme</span> is not
      "<code title>file</code>", set
      <var title>url</var>'s <span title=concept-url-host>host</span> to
      <var title>base</var>'s <span title=concept-url-host>host</span> and
      <var title>url</var>'s <span title=concept-url-port>port</span> to
      <var title>base</var>'s <span title=concept-url-port>port</span>.

      <pre class=example>file:/example.org/</pre>

     <li><p>Set <var title>state</var> to <span>relative path state</span>,
     and decrease <var title>pointer</var> by one.
    </ol>

   <dt><dfn>authority first slash state</dfn>
   <dd>
    <p>If <span>c</span> is "<code title>/</code>", set
    <var title>state</var> to <span>authority second slash state</span>.

    <p>Otherwise, <span>parse error</span>, set <var title>state</var> to
    <span>authority ignore slashes state</span>, and decrease
    <var title>pointer</var> by one.

   <dt><dfn>authority second slash state</dfn>
   <dd>
    <p>If <span>c</span> is "<code title>/</code>", set
    <var title>state</var> to <span>authority ignore slashes state</span>.

    <p>Otherwise, <span>parse error</span>, set <var title>state</var> to
    <span>authority ignore slashes state</span>, and decrease
    <var title>pointer</var> by one.

   <dt><dfn>authority ignore slashes state</dfn>
   <dd>
    <p>If <span>c</span> is neither "<code title>/</code>" nor
    "<code title>\</code>", set <var title>state</var> to
    <span>authority state</span>, and decrease <var title>pointer</var> by one.

    <p>Otherwise, <span>parse error</span>.

   <dt><dfn>authority state</dfn>
   <dd>
    <ol>
     <li>
      <p>If <span>c</span> is "<code title>@</code>", run these substeps:

      <ol>
       <li><p>If the <var title>@ flag</var> is set,
       <span>parse error</span>, prepend "<code title>%40</code>" to
       <var title>buffer</var>.

       <li><p>Set the <var title>@ flag</var>.

       <li>
        <p>For each <var title>code point</var> in <var title>buffer</var>, run these substeps:

        <ol>
         <li><p>If <var title>code point</var> is U+0009, U+000A, or U+000D,
         <span>parse error</span>, continue.

         <li><p>If <var title>code point</var> is not a
         <span title="URL code points">URL code point</span> and not
         "<code title>%</code>", <span>parse error</span>.

         <li><p>If <var title>code point</var> is "<code title>%</code>" and
         <span>remaining</span> does not start with two
         <span>ASCII hex digits</span>, <span>parse error</span>.

         <li><p>If <var title>code point</var> is "<code title>:</code>" and
         <var title>url</var>'s
         <span title=concept-url-password>password</span> is null, set
         <var title>url</var>'s <span title=concept-url-password>password</span>
         to the empty string and continue.

         <li><p><span>utf-8 percent encode</span> <var title>code point</var> using
         the <span>default encode set</span> and append the result to
         <var title>url</var>'s <span title=concept-url-password>password</span>
         if <var title>url</var>'s <span title=concept-url-password>password</span>
         is non-null, and to
         <var title>url</var>'s <span title=concept-url-username>username</span>
         otherwise.
        </ol>
       <li><p>Set <var title>buffer</var> to the empty string.
      </ol>

     <li><p>Otherwise, if <span>c</span> is one of <span>EOF code point</span>,
     "<code title>/</code>", "<code title>\</code>", "<code title>?</code>",
     and "<code title>#</code>", decrease <var title>pointer</var> by the
     number of code points in <var title>buffer</var> plus one, set
     <var title>buffer</var> to the empty string, and
     <var title>state</var> to <span>host state</span>.

     <li><p>Otherwise, append <span>c</span> to <var title>buffer</var>.
    </ol>

   <dt><dfn>file host state</dfn>
   <dd>
    <ol>
     <li>
      <p>If <span>c</span> is one of <span>EOF code point</span>,
      "<code title>/</code>", "<code title>\</code>", "<code title>?</code>",
      and "<code title>#</code>", decrease <var title>pointer</var> by one,
      and run these substeps:

      <ol>
       <li>
        <p>If <var title>buffer</var> consists of two code points, of
        which the first is an <span>ASCII alpha</span> and the second is
        either "<code title>:</code>" or "<code title>|</code>", set
        <var title>state</var> to <span>relative path state</span>.

        <p class=note>This is a (platform-independent) Windows drive letter quirk.
        <var title>buffer</var> is not reset here and instead used in the
        <span>relative path state</span>.

       <li><p>Otherwise, if <var title>buffer</var> is the empty string, set
       <var title>state</var> to <span>relative path start state</span>.

       <li>
        <p>Otherwise, run these steps:

        <ol>
         <li><p>Let <var title>host</var> be the result of
         <span title=concept-host-parser>host parsing</span>
         <var title>buffer</var>.

         <li><p>If <var title>host</var> is failure, return failure.

         <li><p>Set
         <var title>url</var>'s <span title=concept-url-host>host</span> to
         <var title>host</var>, <var title>buffer</var> to the empty string,
         and <var title>state</var> to <span>relative path start state</span>.
        </ol>
      </ol>

     <li><p>Otherwise, if <span>c</span> is U+0009, U+000A, or U+000D,
     <span>parse error</span>.

     <li><p>Otherwise, append <span>c</span> to <var title>buffer</var>.
    </ol>

   <dt><dfn>host state</dfn>
   <dt><dfn>hostname state</dfn>
   <dd>
    <ol>
     <li>
      <p>If <span>c</span> is "<code title>:</code>" and the
      <var title>[] flag</var> is unset, run these substeps:

      <ol>
       <li><p>Let <var title>host</var> be the result of
       <span title=concept-host-parser>host parsing</span>
       <var title>buffer</var>.

       <li><p>If <var title>host</var> is failure, return failure.

       <li><p>Set <var title>url</var>'s <span title=concept-url-host>host</span> to
       <var title>host</var>, <var title>buffer</var> to the empty string,
       and <var title>state</var> to <span>port state</span>.

       <li><p>If <var title>state override</var> is <span>hostname state</span>,
       terminate this algorithm.
      </ol>

     <li>
      <p>Otherwise, if <span>c</span> is the
      <span>EOF code point</span>, "<code title>/</code>",
      "<code title>\</code>", "<code title>?</code>", or
      "<code title>#</code>", decrease <var title>pointer</var> by one, and
      run these substeps:

      <ol>
       <li><p>Let <var title>host</var> be the result of
       <span title=concept-host-parser>host parsing</span>
       <var title>buffer</var>.

       <li><p>If <var title>host</var> is failure, return failure.

       <li><p>Set <var title>url</var>'s <span title=concept-url-host>host</span> to
       <var title>host</var>, <var title>buffer</var> to the empty string,
       and <var title>state</var> to <span>relative path start state</span>.

       <li><p>If <var title>state override</var> is given, terminate this
       algorithm.
      </ol>

     <li><p>Otherwise, if <span>c</span> is U+0009, U+000A, or U+000D,
     <span>parse error</span>.

     <li>
      <p>Otherwise, run these substeps:

      <ol>
       <li><p>If <span>c</span> is "<code title>[</code>", set the
       <var title>[] flag</var>.

       <li><p>If <span>c</span> is "<code title>]</code>", unset the
       <var title>[] flag</var>.

       <li><p>Append <span>c</span> to <var title>buffer</var>.
      </ol>
    </ol>

   <dt><dfn>port state</dfn>
   <dd>
    <ol>
     <li><p>If <span>c</span> is an <span title="ASCII digits">ASCII digit</span>,
     append <span>c</span> to <var title>buffer</var>.

     <li>
      <p>Otherwise, if <span>c</span> is one of
      <span>EOF code point</span>, "<code title>/</code>",
      "<code title>\</code>", "<code title>?</code>", and
      "<code title>#</code>", or <var title>state override</var> is given, run
      these substeps:
      <ol>
       <li>
        <p>Remove leading U+0030 code points from <var title>buffer</var>
        until either the leading code point is not U+0030 or
        <var title>buffer</var> is one code point.

        <div class=example><!-- putting class=example on table has side effects -->
        <table>
         <tr><th>Input<th>Output
         <tr><td>"<code title>42</code>"<td>"<code title>42</code>"
         <tr><td>"<code title>031</code>"<td>"<code title>31</code>"
         <tr><td>"<code title>080</code>"<td>"<code title>80</code>"
         <tr><td>"<code title>0000</code>"<td>"<code title>0</code>"
        </table>
        </div>

       <li><p>If <var title>buffer</var> is equal to
       <var title>url</var>'s <span title=concept-url-scheme>scheme</span>'s
       <span>default port</span>, set <var title>buffer</var> to the empty
       string.

       <li><p>Set <var title>url</var>'s
       <span title=concept-url-port>port</span> to <var title>buffer</var>.

       <li><p>If <var title>state override</var> is given, terminate this
       algorithm.

       <li><p>Set <var title>buffer</var> to the empty string,
       <var title>state</var> to <span>relative path start state</span>, and
       decrease <var title>pointer</var> by one.
      </ol>

     <li><p>Otherwise, if <span>c</span> is U+0009, U+000A, or U+000D,
     <span>parse error</span>.

     <li><p>Otherwise, <span>parse error</span>, return failure.
    </ol>

   <dt><dfn>relative path start state</dfn>
   <dd>
    <ol>
     <li><p>If <span>c</span> is "<code title>\</code>",
     <span>parse error</span>.

     <li><p>Set <var title>state</var> to <span>relative path state</span>
     and if <span>c</span> is neither "<code title>/</code>" nor
     "<code title>\</code>", decrease <var title>pointer</var> by one.
    </ol>

   <dt><dfn>relative path state</dfn>
   <dd>
    <ol>
     <li>
      <p>If either <span>c</span> is one of
      <span>EOF code point</span>, "<code title>/</code>", and
      "<code title>\</code>", or <var title>state override</var> is not given and
      <span>c</span> is one of "<code title>?</code>" and
      "<code title>#</code>", run these substeps:
      <ol>
       <li><p>If <span>c</span> is "<code title>\</code>", <span>parse error</span>.

       <li>
        <p>If <var title>buffer</var>, lowercased, matches any row in the first column of
        the following table, set <var title>buffer</var> to the contents of the cell in
        the second column of the matched row:

        <table>
         <tr><td>"<code title>%2e</code>"   <td>"<code title>.</code>"
         <tr><td>"<code title>.%2e</code>"  <td rowspan=3>"<code title>..</code>"
         <tr><td>"<code title>%2e.</code>"
         <tr><td>"<code title>%2e%2e</code>"
        </table>

       <li><p>If <var title>buffer</var> is "<code title>..</code>", pop
       <var title>url</var>'s <span title=concept-url-path>path</span>, if non-empty, and
       then if <span>c</span> is neither  "<code title>/</code>" nor
       "<code title>\</code>", append the empty string to <var title>url</var>'s
       <span title=concept-url-path>path</span>.

       <li><p>Otherwise, if <var title>buffer</var> is "<code title>.</code>" and
       <span>c</span> is neither "<code title>/</code>" nor "<code title>\</code>",
       append an empty string to
       <var title>url</var>'s <span title=concept-url-path>path</span>.

       <li>
        <p>Otherwise, if <var title>buffer</var> is not
        "<code title>.</code>", run these subsubsteps:

        <ol>
         <li>
          <p>If <var title>url</var>'s <span title=concept-url-scheme>scheme</span> is
          "<code title>file</code>", <var title>url</var>'s <span title=concept-url-path>path</span>
          is the empty list, <var title>buffer</var> consists of two
          code points, of which the first is an <span>ASCII alpha</span>,
          and the second is "<code title>|</code>", replace the second code point in
          <var title>buffer</var> with "<code title>:</code>".

          <p class=note>This is a (platform-independent) Windows drive letter quirk.
          They are beautiful, no?

         <li><p>Append <var title>buffer</var> to
         <var title>url</var>'s <span title=concept-url-path>path</span>.
        </ol>

       <li><p>Set <var title>buffer</var> to the empty string.

       <li><p>If <span>c</span> is "<code title>?</code>", set
       <var title>url</var>'s <span title=concept-url-query>query</span> to the empty string,
       and <var title>state</var> to <span>query state</span>.

       <li><p>If <span>c</span> is "<code title>#</code>", set
       <var title>url</var>'s <span title=concept-url-fragment>fragment</span> to the empty string,
       and <var title>state</var> to <span>fragment state</span>.
      </ol>

     <li><p>Otherwise, if <span>c</span> is U+0009, U+000A, or U+000D,
     <span>parse error</span>.

     <li>
      <p>Otherwise, run these steps:

      <ol>
       <li><p>If <span>c</span> is not a
       <span title="URL code points">URL code point</span> and not "<code title>%</code>",
       <span>parse error</span>.

       <li><p>If <span>c</span> is "<code title>%</code>" and <span>remaining</span> does
       not start with two <span>ASCII hex digits</span>, <span>parse error</span>.

       <li><p><span>utf-8 percent encode</span> <span>c</span> using the
       <span>default encode set</span>, and append the result to
       <var title>buffer</var>.
      </ol>
    </ol>

   <dt><dfn>query state</dfn>
   <dd>
    <ol>
     <li>
      <p>If <span>c</span> is the <span>EOF code point</span> or
      <var title>state override</var> is not given and <span>c</span>
      is "<code title>#</code>", run these substeps:

      <ol>
       <li><p>If <var title>url</var>'s <span>relative flag</span> is set,
       set <var title>encoding override</var> to
       <span data-anolis-spec=encoding>utf-8</span>.
       <!-- http://simon.html5.org/test/url/url-encoding.html -->

       <li><p>Set <var title>buffer</var> to the result of running
       <var title>encoding override</var>'s
       <span data-anolis-spec=encoding>encoder</span> on
       <var title>buffer</var>, with <var title>encoding override</var>'s
       <span data-anolis-spec=encoding>encoder</span>'s
       <span data-anolis-spec=encoding>error handling mode</span> set to <i title>URL</i>.

       <li>
        <p>For each <var title>byte</var> in <var title>buffer</var> run
        these subsubsteps:

        <ol>
         <li><p>If <var title>byte</var> is less than 0x21, greater than
         0x7E, or is one of 0x22, 0x23, 0x3C, 0x3E, and 0x60, append
         <var title>byte</var>,
         <span title="percent encode">percent encoded</span>, to
         <var title>url</var>'s <span title=concept-url-query>query</span>.

         <li><p>Otherwise, append a code point whose value is
         <var title>byte</var> to <var title>url</var>'s
         <span title=concept-url-query>query</span>.
        </ol>

       <li><p>Set <var title>buffer</var> to the empty string.

       <li><p>If <span>c</span> is "<code title>#</code>", set
       <var title>url</var>'s
       <span title=concept-url-fragment>fragment</span> to the empty string,
       and state to <span>fragment state</span>.
      </ol>

     <li><p>Otherwise, if <span>c</span> is U+0009, U+000A, or U+000D,
     <span>parse error</span>.

     <li>
      <p>Otherwise, run these substeps:

      <ol>
       <li><p>If <span>c</span> is not a
       <span title="URL code points">URL code point</span> and not "<code title>%</code>",
       <span>parse error</span>.

       <li><p>If <span>c</span> is "<code title>%</code>" and <span>remaining</span> does
       not start with two <span>ASCII hex digits</span>, <span>parse error</span>.

       <li><p>Append <span>c</span> to <var title>buffer</var>.
      </ol>
    </ol>

   <dt><dfn>fragment state</dfn>
   <dd>
    <p>Based on <span>c</span>:
    <dl class=switch>
     <dt><span>EOF code point</span>
     <dd><p>Do nothing.

     <dt>U+0009
     <dt>U+000A
     <dt>U+000D
     <dd><p><span>Parse error</span>.

     <dt>Otherwise
     <dd>
      <ol>
       <li><p>If <span>c</span> is not a
       <span title="URL code points">URL code point</span> and not
       "<code title>%</code>", <span>parse error</span>.

       <li><p>If <span>c</span> is "<code title>%</code>" and <span>remaining</span> does
       not start with two <span>ASCII hex digits</span>, <span>parse error</span>.

       <li><p><span>utf-8 percent encode</span> <span>c</span>
       using the <span>simple encode set</span>, and append the result to
       <var title>url</var>'s <span title=concept-url-fragment>fragment</span>.
       <!-- if people complain about percent encoding do not forget that
            results may differ depending on whether or not a relative scheme
            is in play -->
      </ol>
    </dl>
  </dl>

 <li><p>Return <var title>url</var>.
</ol>

<h3>Serializing</h3>

<p>The <dfn title=concept-url-serializer>URL serializer</dfn> takes a
<span title=concept-parsed-url>parsed URL</span> <var title>url</var>,
optionally an <i title>exclude fragment flag</i>, and then runs these steps:

<ol>
 <li><p>Let <var title>output</var> be <var title>url</var>'s
 <span title=concept-url-scheme>scheme</span> and
 "<code title>:</code>" concatenated.

 <li>
  <p>If <var title>url</var>'s <span>relative flag</span> is set:

  <ol>
   <li><p>Append "<code title>//</code>" to <var title>output</var>.

   <li>
    <p>If <var title>url</var>'s
    <span title=concept-url-username>username</span> is not the empty string
    or <var title>url</var>'s
    <span title=concept-url-password>password</span> is non-null, run these
    substeps:

    <ol>
     <li><p>Append <var title>url</var>'s
     <span title=concept-url-username>username</span> to
     <var title>output</var>.

     <li><p>If <var title>url</var>'s
     <span title=concept-url-password>password</span> is non-null, append
     "<code title>:</code>" concatenated with <var title>url</var>'s
     <span title=concept-url-password>password</span> to
     <var title>output</var>.

     <li><p>Append "<code title>@</code>" to <var title>output</var>.
    </ol>

   <li><p>Append <var title>url</var>'s
   <span title=concept-url-host>host</span>,
   <span title=concept-host-serializer>serialized</span>, to
   <var title>output</var>.

   <li><p>If <var title>url</var>'s <span title=concept-url-port>port</span>
   is not the empty string, append "<code title>:</code>" concatenated with
   <var title>url</var>'s <span title=concept-url-port>port</span> to
   <var title>output</var>.

   <li><p>Append "<code title>/</code>" concatenated with the strings in
   <var title>url</var>'s <span title=concept-url-path>path</span>
   (including empty strings), separated from each other by
   "<code title>/</code>" to <var title>output</var>.
  </ol>

 <li><p>Otherwise, if <var title>url</var>'s <span>relative flag</span> is
 unset, append <var title>url</var>'s
 <span title=concept-url-scheme-data>scheme data</span> to
 <var title>output</var>.

 <li><p>If <var title>url</var>'s <span title=concept-url-query>query</span> is non-null,
 append "<code title>?</code>" concatenated with <var title>url</var>'s
 <span title=concept-url-query>query</span> to <var title>output</var>.

 <li><p>If the <i title>exclude fragment flag</i> is unset and
 <var title>url</var>'s <span title=concept-url-fragment>fragment</span> is
 non-null, append  "<code title>#</code>" concatenated with
 <var title>url</var>'s <span title=concept-url-fragment>fragment</span> to
 <var title>output</var>.

 <li><p>Return <var title>output</var>.
</ol>



<h2><code>application/x-www-form-urlencoded</code></h2>

<p>The
<dfn title=concept-urlencoded-parser><code>application/x-www-form-urlencoded</code> parser</dfn>
takes a string <var title>input</var> using code points in the range U+0000 to U+007F,
optionally with an <span data-anolis-spec=encoding>encoding</span>
<var title>encoding override</var>, optionally with a
<i title>use "<code>_charset_</code>" flag</i>, and optionally with an
<i title>isindex flag</i>, and then runs these steps:

<ol>
 <li><p>Let <var title>strings</var> be the result of splitting
 <var title>input</var> on "<code title>&</code>".
 <!-- XXX define splitting? DOM does not do it -->

 <li><p>If the <i title>isindex flag</i> is set and the first string in
 <var title>strings</var> does not contain a "<code title>=</code>", prepend
 "<code title>=</code>" to the first string in <var title>strings</var>.

 <li><p>If <var title>encoding override</var> is not given, set it to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Let <var title>pairs</var> be an empty list of name-value pairs.

 <li>
  <p>For each string <var title>string</var> in <var title>strings</var>,
  run these substeps:

  <ol>
   <li><p>If <var title>string</var> is the empty string, run these substeps
   again for the next string.

   <li><p>If string contains a "<code title>=</code>", then let
   <var title>name</var> be the substring of <var title>string</var> from
   the start of <var title>string</var> up to but excluding its first
   "<code title>=</code>", and let <var title>value</var> be the substring
   from the first code point, if any, after the first "<code title>=</code>"
   up to the end of <var title>string</var>. If "<code title>=</code>" is
   the first code point, then <var title>name</var> will be the empty
   string. If it is the last, then <var title>value</var> will be the empty
   string.

   <li><p>Otherwise, let <var title>name</var> have the value of
   <var title>string</var> and let <var title>value</var> be the empty
   string.

   <li><p>Replace any "<code title>+</code>" in <var title>name</var> and
   <var title>value</var> with U+0020.

   <li><p>If the <i title>use "<code>_charset_</code>" flag</i> is set,
   <var title>name</var> is "<code title>_charset_</code>", and
   <span data-anolis-spec=encoding title=concept-encoding-get>get an encoding</span>
   for <var title>value</var> does not return failure, unset the
   <i title>use "<code>_charset_</code>" flag</i> and set
   <var title>encoding override</var> to the result of
   <span data-anolis-spec=encoding title=concept-encoding-get>getting an encoding</span>
   for <var title>value</var>.

   <li><p>Add a pair consisting of <var title>name</var> and
   <var title>value</var> to <var title>pairs</var>.
  </ol>

 <li><p>Replace each name-value pair in <var title>pairs</var> with the
 result of running <var title>encoding override</var>'s
 <span data-anolis-spec=encoding>decoder</span> on the
 <span title="percent decode">percent decoding</span> of the name-value pair.

 <li><p>Return <var title>pairs</var>.
</ol>

<p>The
<dfn title=concept-urlencoded-byte-serializer><code>application/x-www-form-urlencoded</code> byte serializer</dfn>
takes a byte sequence <var title>input</var> and then runs these steps:

<ol>
 <li><p>Let <var title>output</var> be the empty string.
 <li>
  <p>For each byte in <var title>input</var>, depending on
  <var title>byte</var>:

  <dl>
   <dt>0x20
   <dd><p>Append U+002B to <var title>output</var>.

   <dt>0x2A
   <dt>0x2D
   <dt>0x2E
   <dt>0x30 to 0x39
   <dt>0x41 to 0x5A
   <dt>0x5F
   <dt>0x61 to 0x7A
   <dd><p>Append a code point whose value is <var title>byte</var> to
   <var title>output</var>.

   <dt>Otherwise
   <dd><p>Append <var title>byte</var>,
   <span title="percent encode">percent encoded</span>, to
   <var title>output</var>.
  </dl>
 <li><p>Return <var title>output</var>.
</ol>
<!-- The inverse of the above byte set is all bytes
     less than 0x20,
     0x21 to 0x29,
     0x2B,
     0x2C,
     0x2F,
     0x3A to 0x40,
     0x5B to 0x5E,
     0x60,
     bytes greater than 0x7A -->

<p>The
<dfn title=concept-urlencoded-serializer><code>application/x-www-form-urlencoded</code> serializer</dfn>
takes a list of name-value pairs <var title>pairs</var>, optionally with an
<span data-anolis-spec=encoding>encoding</span>
<var title>encoding override</var>, and then runs these steps:

<ol>
 <li><p>If <var title>encoding override</var> is not given, set it to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Let <var title>output</var> be the empty string.

 <li>
  <p>For each <var title>pair</var> in <var title>pairs</var>, run
  these substeps:

  <ol>
   <li><p>Replace <var title>pair</var>'s name and value with the result of
   running <var title>encoding override</var>'s
   <span data-anolis-spec=encoding>encoder</span> on them, with
   <var title>encoding override</var>'s <span data-anolis-spec=encoding>encoder</span>'s
   <span data-anolis-spec=encoding>error handling mode</span> set to
   <i title>&lt;form></i>, respectively.

   <li><p>Replace <var title>pair</var>'s name and value with their
   <span title=concept-urlencoded-byte-serializer>serialization</span>.

   <li><p>If this is not the first pair, append "<code title>&</code>" to
   <var title>output</var>.

   <li><p>Append <var title>pair</var>'s name, followed by
   "<code title>=</code>", followed by <var title>pair</var>'s value to
   <var title>output</var>.
  </ol>

 <li>Return <var title>output</var>.
</ol>



<h2>API</h2>

<!-- XXX https://www.w3.org/Bugs/Public/show_bug.cgi?id=20159 -->

<pre class=idl>[<span title=dom-URL>Constructor</span>(DOMString <var title>url</var>, optional (<span>URL</span> or DOMString) <var title>base</var> = "about:blank")]
interface <dfn>URL</dfn> {
  static DOMString <span title=dom-URL-domainToASCII>domainToASCII</span>([EnsureUTF16] DOMString <var title>domain</var>);
  static DOMString <span title=dom-URL-domainToUnicode>domainToUnicode</span>([EnsureUTF16] DOMString <var title>domain</var>);
};
<span>URL</span> implements <span>URLUtils</span>;

[NoInterfaceObject]
interface <dfn>URLUtils</dfn> {
  stringifier attribute [EnsureUTF16] DOMString <span title=dom-URL-href>href</span>;
  readonly attribute DOMString <span title=dom-URL-origin>origin</span>;

           attribute [EnsureUTF16] DOMString <span title=dom-URL-protocol>protocol</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-username>username</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-password>password</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-host>host</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-hostname>hostname</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-port>port</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-pathname>pathname</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-search>search</span>;
           attribute <span>URLQuery</span>? <span title=dom-URL-query>query</span>;
           attribute [EnsureUTF16] DOMString <span title=dom-URL-hash>hash</span>;
};

[NoInterfaceObject]
interface <dfn>URLUtilsReadOnly</dfn> {
  stringifier readonly attribute DOMString <span title=dom-URL-href>href</span>;<!--
  readonly attribute DOMString <span title=dom-URL-origin>origin</span>;-->

  readonly attribute DOMString <span title=dom-URL-protocol>protocol</span>;<!--
  readonly attribute DOMString <span title=dom-URL-username>username</span>;
  readonly attribute DOMString <span title=dom-URL-password>password</span>;-->
  readonly attribute DOMString <span title=dom-URL-host>host</span>;
  readonly attribute DOMString <span title=dom-URL-hostname>hostname</span>;
  readonly attribute DOMString <span title=dom-URL-port>port</span>;
  readonly attribute DOMString <span title=dom-URL-pathname>pathname</span>;
  readonly attribute DOMString <span title=dom-URL-search>search</span>;<!--
  readonly attribute <span>URLQuery</span>? <span title=dom-URL-query>query</span>;-->
  readonly attribute DOMString <span title=dom-URL-hash>hash</span>;
};</pre>

<p>Except where different objects implementing <code>URLUtilsReadOnly</code> are identical
to objects implementing <code>URLUtils</code>.

<p class=note>Since all members are readonly and certain members from
<code>URLUtils</code> are not exposed a number of potential optimizations is possible
compared to objects implementing <code>URLUtils</code>. These are left as an exercise to
the reader.

<!-- XXX Ideas:
  boolean isEqual(URL, optional URLEqualOptions options)
           attribute URLPath segments;

dictionary URLEqualOptions {
  boolean percentEncoding = false;
  boolean ignoreHash = false;
  boolean ignoreDomainDot = false;
  ...
};

URLPath would be a subclassed Array? -->

<p>Specifications defining objects implementing <code>URLUtils</code> or
<code>URLUtilsReadOnly</code> must define a
<dfn title=concept-UU-get-the-base>get the base</dfn> algorithm, which must return the
appropriate <span title=concept-base-URL>base URL</span> for the object.

<p>Specifications defining objects implementing <code>URLUtils</code> may
define <dfn title=concept-UU-update>update steps</dfn> to make it possible for an
underlying string (such as an
<span data-anolis-spec=dom title=concept-attribute-value>attribute value</span>)
to be updated. The <span title=concept-UU-update>update steps</span> are passed a string
<var title>value</var> for this purpose.

<p>An object implementing <code>URLUtils</code> or <code>URLUtilsReadOnly</code> has an
associated <dfn title=concept-UU-input>input</dfn> (a string),
<dfn title=concept-UU-query-encoding>query encoding</dfn>
(an <span data-anolis-spec=encoding>encoding</span>),
<dfn title=concept-UU-query-object>query object</dfn>
(a <code>URLQuery</code> object or null), and a
<dfn title=concept-UU-url>url</dfn> (a
<span title=concept-parsed-url>parsed URL</span> or null).

Unless stated otherwise, <span title=concept-UU-query-encoding>query encoding</span> is
<span data-anolis-spec=encoding>utf-8</span>. The others follow from the
<span title=concept-UU-set-the-input>set the input</span> algorithm.

<p class=note>The associated
<span title=concept-UU-query-encoding>query encoding</span> is a legacy
concept only relevant for HTML.
<span data-anolis-ref class=informative>HTML</span>

<p>Specifications defining objects implementing <code>URLUtils</code> or
<code>URLUtilsReadOnly</code> must use the
<span title=concept-UU-set-the-input>set the input</span> algorithms to set
<span title=concept-UU-input>input</span>, <span title=concept-UU-url>url</span>, and
<span title=concept-UU-query-object>query object</span>. To
<dfn title=concept-UU-set-the-input>set the input</dfn> run these steps:

<ol>
 <li><p>Set <span title=concept-UU-url>url</span> to null.

 <li><p>Set <span title=concept-UU-input>input</span> to the given value.

 <li><p>Let <var title>parsed URL</var> be the result of
 <span title=concept-url-parser>parsing</span>
 <span title=concept-UU-input>input</span> with
 <span title=concept-base-url>base URL</span> being the result of running
 <span title=concept-UU-get-the-base>get the base</span> and
 <span title=concept-UU-query-encoding>query encoding</span> as
 <var title>encoding override</var>.

 <li><p>If <var title>parsed URL</var> is not failure, set
 <span title=concept-UU-url>url</span> to <var title>parsed URL</var>.

 <li>
  <p>If <span title=concept-UU-url>url</span> is non-null and its
  <span>relative flag</span> is set, run these substeps:

  <ol>
   <li><p>If <span title=concept-UU-query-object>query object</span> is null, set
   <span title=concept-UU-query-object>query object</span> to a
   <span title=concept-UQ-new>new <code>URLQuery</code> object</span> using
   <span title=concept-UU-url>url</span>'s <span title=concept-URL-query>query</span>.

   <li><p>Otherwise, set <span title=concept-UU-query-object>query object</span>'s
   associated list of name-value pairs to the result of
   <span title=concept-urlencoded-parser>parsing</span>
   <span title=concept-UU-url>url</span>'s <span title=concept-URL-query>query</span>.
  </ol>

 <li><p>If <span title=concept-UU-url>url</span> is null and
 <span title=concept-UU-query-object>query object</span> is non-null, empty
 <span title=concept-UU-query-object>query object</span>'s associated list of name-value
 pairs.
</ol>

<p>To run the <dfn>pre-update steps</dfn> for an object implementing
<code>URLUtils</code>, optionally given a <var title>value</var>, run these steps:

<ol>
 <li><p>If <var title>value</var> is not given, let <var title>value</var> be the result
 of <span title=concept-url-serializer>serializing</span> the associated
 <span title=concept-UU-url>url</span>.
 <!-- these steps are always invoked with a value if url can be null -->

 <li><p>Run the <span title=concept-UU-update>update steps</span> with
 <var title>value</var>.
</ol>


<h3>Constructors</h3> <!-- "constructor" causes dfn.js to fail -->

<p>The
<dfn title=dom-URL><code>URL(<var title>url</var>, <var title>base</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li><p>If <var title>base</var> is a string,
 <span title=concept-url-parser>parse</span> <var title>base</var> and set
 <var title>base</var> to the result of that algorithm.

 <li><p>If <var title>base</var> is failure, <span data-anolis-spec=webidl>throw</span> a
 <code title>TypeError</code> exception.

 <li><p>Let <var title>result</var> be a new <code>URL</code> object.

 <li><p>Let <var title>result</var>'s
 <span title=concept-UU-get-the-base>get the base</span> return <var title>base</var>.

 <li><p>Run <var title>result</var>'s
 <span title=concept-UU-set-the-input>set the input</span> for <var title>url</var>.

 <li><p>If <var title>result</var>'s <span title=concept-UU-url>url</span> is null,
 <span data-anolis-spec=webidl>throw</span> a <code title>TypeError</code> exception.

 <li><p>Return <var title>result</var>.
</ol>

<div class=example>
 <p>To <span title=concept-url-parser>parse</span> a <span title=concept-url>URL</span>
 without using a <span title=concept-base-url>base URL</span>, invoke the constructor with
 a single argument:

 <pre>var input = "http://example.org/💩",
    url = new URL(input)
url.pathname // "/%F0%9F%92%A9"</pre>

 <p>If you rather resolve it against the <span title=concept-base-url>base URL</span> of a
 <span data-anolis-spec=dom title=concept-document>document</span>, use
 <code data-anolis-spec=dom title=dom-Node-baseURI>baseURI</code>:

 <pre>var input = "/💩",
    url = new URL(input, document.baseURI)
url.href // "http://url.spec.whatwg.org/%F0%9F%92%A9"</pre>
</div>


<h3><code>URL</code> statics</h3>

<p>The
<dfn title=dom-URL-domainToASCII><code>domainToASCII(<var>domain</var>)</code></dfn>
static method must run these steps:

<ol>
 <li><p>Let <var title>internalDomain</var> be the result of splitting
 <var title>domain</var> on any <span>domain label separators</span>.

 <li><p>Let <var title>asciiDomain</var> be the result of running
 <span title=concept-domain-to-ascii>domain to ASCII</span> on
 <var title>internalDomain</var>.

 <li><p>If <var title>asciiDomain</var> is failure, return <var title>domain</var>.

 <li><p>Return <var title>asciiDomain</var>,
 <span title=concept-host-serializer>serialized</span>.
</ol>

<p>The
<dfn title=dom-URL-domainToUnicode><code>domainToUnicode(<var>domain</var>)</code></dfn>
static method must run these steps:

<ol>
 <li><p>Let <var title>internalDomain</var> be the result of splitting
 <var title>domain</var> on any <span>domain label separators</span>.

 <li><p>Let <var title>unicodeDomain</var> be the result of running
 <span title=concept-domain-to-unicode>domain to Unicode</span> on
 <var title>internalDomain</var>.

 <li><p>Return <var title>unicodeDomain</var>,
 <span title=concept-host-serializer>serialized</span>.
</ol>


<h3><code>URLUtils</code> and <code>URLUtilsReadOnly</code> members</h3>

<p class=note>The <code>URLUtils</code> and <code>URLUtilsReadOnly</code> interfaces are
not exposed on the global object. They are meant to augment other interfaces, such as
<code>URL</code>.

<p>The <dfn title=dom-URL-href><code>href</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return
 <span title=concept-UU-input>input</span>.

 <li><p>Return the <span title=concept-url-serializer>serialization</span>
 of <span title=concept-UU-url>url</span>.
</ol>

<p>Setting the <code title=dom-URL-href>href</code> attribute must
run these steps:

<ol>
 <li><p>Run the <span title=concept-UU-set-the-input>set the input</span> algorithm for
 the given value.

 <li><p>If the <span>context object</span> is a <code>URL</code> object and its
 <span title=concept-UU-url>url</span> is null,
 <span data-anolis-spec=webidl>throw</span> a <code title>TypeError</code> exception.

 <li><p>Run the <span>pre-update steps</span> with the given value.
</ol>

<p class=note>This means that if the <code title=dom-URL-href>href</code> attribute is set
to value that would cause the <span title=concept-url-parser>parser</span> to return
failure, that value is still passed through unchanged. This is one of those unfortunate
legacy incidents.
<!--
  var urlPoop = "http://poop:poop/"
  <a>.href = urlPoop
  <a>.getAttribute("href") == urlPoop
-->

<p>The <dfn title=dom-URL-origin><code>origin</code></dfn> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the empty
 string.

 <li><p>Return the <span data-anolis-spec=origin>Unicode serialization</span>
 of <span title=concept-UU-url>url</span>'s
 <span data-anolis-spec=origin>origin</span>.
 <span data-anolis-ref>ORIGIN</span>
</ol>

<p class=note>It returns the Unicode rather than the ASCII serialization for
compatibility with HTML's <code>MessageEvent</code> feature.
<span data-anolis-ref class=informative>HTML</span>

<p>The <dfn title=dom-URL-protocol><code>protocol</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return
 "<code title>:</code>".

 <li><p>Return <span title=concept-url-scheme>scheme</span> and
 "<code title>:</code>" concatenated.
</ol>

<p>Setting the <code title=dom-URL-protocol>protocol</code> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, terminate
 these steps.

 <li><p><span title=concept-url-parser>Parse</span> the given value and
 "<code title>:</code>" concatenated with
 <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>scheme start state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-username><code>username</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the
 empty string.

 <li><p>Return <span title=concept-url-username>username</span>.
</ol>

<p>Setting the <code title=dom-URL-username>username</code> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p>Set <span title=concept-url-username>username</span> to the empty
 string.

 <li><p>For each code point in the given value,
 <span>utf-8 percent encode</span> it using the
 <span>username encode set</span>, and append the result to
 <span title=concept-url-username>username</span>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-password><code>password</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null or its
 <span title=concept-url-password>password</span> is null, return the empty
 string.

 <li><p>Return <span title=concept-url-password>password</span>.
</ol>

<p>Setting the <code title=dom-URL-password>password</code> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p>If the given value is the empty string, set
 <span title=concept-url-password>password</span> to null, run the
 <span>pre-update steps</span>, and terminate these steps.

 <li><p>Set <span title=concept-url-password>password</span> to the empty string.

 <li><p>For each code point in the given value, <span>utf-8 percent encode</span> it
 using the <span>password encode set</span>, and append the result to
 <span title=concept-url-password>password</span>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-host><code>host</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the
 empty string.

 <li><p>If <span title=concept-url-port>port</span> is the empty string,
 return <span title=concept-url-host>host</span>,
 <span title=concept-host-serializer>serialized</span>.

 <li><p>Return <span title=concept-url-host>host</span>,
 <span title=concept-host-serializer>serialized</span>,
 "<code title>:</code>", and <span title=concept-url-port>port</span>
 concatenated.
</ol>

<p>Setting the <code title=dom-URL-host>host</code> attribute must run these
steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p><span title=concept-url-parser>Parse</span> the given value with
 <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>host state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-hostname><code>hostname</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the
 empty string.

 <li><p>Return <span title=concept-url-host>host</span>,
 <span title=concept-host-serializer>serialized</span>.
</ol>

<p>Setting the <code title=dom-URL-hostname>hostname</code> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p><span title=concept-url-parser>Parse</span> the given value with
 <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>hostname state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-port><code>port</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the
 empty string.

 <li><p>Return <span title=concept-url-port>port</span>.
</ol>

<p>Setting the <code title=dom-URL-port>port</code> attribute must run these
steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, its
 <span>relative flag</span> is unset, or its
 <span title=concept-url-scheme>scheme</span> is "<code title>file</code>",
 terminate these steps.

 <li><p><span title=concept-url-parser>Parse</span> the given value with
 <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>port state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-pathname><code>pathname</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, return the
 empty string.

 <li><p>If the <span>relative flag</span> is unset, return
 <span title=concept-url-scheme-data>scheme data</span>.

 <li><p>Return "<code title>/</code>" concatenated with the strings in
 <span title=concept-url-path>path</span> (including empty strings),
 separated from each other by "<code title>/</code>".
</ol>

<p>Setting the <code title=dom-URL-pathname>pathname</code> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p>Set <span title=concept-url-path>path</span> to the empty list.

 <li><p><span title=concept-url-parser>Parse</span> the given value with
 <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>relative path start state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-search><code>search</code></dfn> attribute must
run these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span title=concept-url-query>query</span> is either null or
 the empty string, return the empty string.

 <li><p>Return "<code title>?</code>" concatenated with
 <span title=concept-url-query>query</span>.
</ol>

<p>Setting the <code title=dom-URL-search>search</code> attribute must run
these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span>relative flag</span> is unset, terminate these steps.

 <li><p>If the given value is the empty string, set
 <span title=concept-url-query>query</span> to null, set
 <span title=concept-UU-query-object>query object</span>'s associated list
 of name-value pairs to the empty list, run the
 <span>pre-update steps</span>, and terminate these steps.

 <li><p>Let <var title>input</var> be the given value with a single leading
 "<code title>?</code>" removed, if any.

 <li><p>Set <span title=concept-url-query>query</span> to the empty string.

 <li><p><span title=concept-url-parser>Parse</span> <var title>input</var>
 with <span title=concept-UU-url>url</span> as <var title>url</var>,
 <span>query state</span> as <var title>state override</var>, and the
 associated <span title=concept-UU-query-encoding>query encoding</span> as
 <var title>encoding override</var>.

 <li><p>Set <span title=concept-UU-query-object>query object</span>'s
 associated list of name-value pairs to the result of
 <span title=concept-urlencoded-parser>parsing</span>
 <var title="">input</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>

<p>The <dfn title=dom-URL-query><code>query</code></dfn> attribute must
return the <span title=concept-UU-query-object>query object</span>.

<p>Setting the <code title=dom-URL-query>query</code> attribute must run
these steps:

<ol>
 <li><p>Let <var title>object</var> be the given value.

 <li><p>If <span title=concept-UU-query-object>query object</span> or
 <var title>object</var> is null, terminate these steps.

 <li><p>If <var title>object</var>'s
 <span title=concept-UQ-url-object>url object</span> is not null, set
 <var title>object</var> to a
 <span title=concept-UQ-new>new <code>URLQuery</code> object</span> using
 <var title>object</var>.

 <li><p>Set <span title=concept-UU-query-object>query object</span> to
 <var title>object</var>.

 <li><p>Run <var title>object</var>'s
 <span title=concept-UQ-update>update steps</span>.
</ol>

<p>The <dfn title=dom-URL-hash><code>hash</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span title=concept-url-fragment>fragment</span> is either null or
 the empty string, return the empty string.

 <li><p>Return "<code title>#</code>" concatenated with
 <span title=concept-url-fragment>fragment</span>.
</ol>

<p>Setting the <code title=dom-URL-hash>hash</code> attribute must run these
steps:

<ol>
 <li><p>If <span title=concept-UU-url>url</span> is null, or its
 <span title=concept-url-scheme>scheme</span> is
 "<code title>javascript</code>", terminate these steps.

 <li><p>If the given value is the empty string, set
 <span title=concept-url-fragment>fragment</span> to null, run the
 <span>pre-update steps</span>, and terminate these steps.

 <li><p>Let <var title>input</var> be the given value with a single leading
 "<code title>#</code>" removed, if any.

 <li><p>Set <span title=concept-url-fragment>fragment</span> to
 the empty string.

 <li><p><span title=concept-url-parser>Parse</span> <var title>input</var>
 with <span title=concept-UU-url>url</span> as <var title>url</var> and
 <span>fragment state</span> as <var title>state override</var>.

 <li><p>Run the <span>pre-update steps</span>.
</ol>


<h3>Interface <code>URLQuery</code></h3>

<pre class=idl>[<span title=dom-URLQuery>Constructor(optional ([EnsureUTF16] DOMString or <span>URLQuery</span>) <var title>init</var> = "")]
interface <dfn>URLQuery</dfn> {
  void <span title=dom-URLQuery-append>append</span>([EnsureUTF16] DOMString <var title>name</var>, [EnsureUTF16] DOMString <var title>value</var>);
  void <span title=dom-URLQuery-delete>delete</span>([EnsureUTF16] DOMString <var title>name</var>);
  DOMString? <span title=dom-URLQuery-get>get</span>([EnsureUTF16] DOMString <var title>name</var>);
  sequence&lt;DOMString> <span title=dom-URLQuery-getAll>getAll</span>([EnsureUTF16] DOMString <var title>name</var>);
  boolean <span title=dom-URLQuery-has>has</span>([EnsureUTF16] DOMString <var title>name</var>);
  void <span title=dom-URLQuery-set>set</span>([EnsureUTF16] DOMString <var title>name</var>, [EnsureUTF16] DOMString <var title>value</var>);
};</pre>

<p>A <code>URLQuery</code> object has an associated list of name-value
pairs, which is initially empty.

<p>A <code>URLQuery</code> object has an associated
<dfn title=concept-UQ-url-object>url object</dfn> which is an object
implementing <code>URLUtils</code> whose
<span title=concept-UU-query-object>query object</span> is the
<code>URLQuery</code> object, and null if there is no such object.

<p class=note><code>URLQuery</code> objects always use
<span data-anolis-spec=encoding>utf-8</span> as
<span data-anolis-spec=encoding>encoding</span>, despite the existence of
concepts such as
<span title=concept-UU-query-encoding>query encoding</span>. This is to
encourage developers to migrate towards
<span data-anolis-spec=encoding>utf-8</span>, which they really ought to
have done a long time ago now.

<p>To create a
<dfn title=concept-UQ-new>new <code>URLQuery</code> object</dfn>, optionally
using <var title>init</var>, run these steps:

<ol>
 <li><p>Let <var title>query</var> be a new <code>URLQuery</code> object.

 <li><p>If <var title>init</var> is the empty string or null, return
 <var title>query</var>.
 <!-- Beware: new URLQuery(null) is equivalent to new URLQuery("null") -->

 <li><p>If <var title>init</var> is a string,
 set <var title>query</var>'s associated list of name-value pairs to the
 result of <span title=concept-urlencoded-parser>parsing</span>
 <var title>input</var>.

 <li><p>If <var title>init</var> is a <code>URLQuery</code> object, set
 <var title>query</var>'s associated list of name-value pairs to a copy of
 <var title>init</var> associated list of name-value pairs.

 <li><p>Return <var title>query</var>.
</ol>

<p>A <code>URLQuery</code> object's
<dfn title=concept-UQ-update>update steps</dfn> are:

<ol>
 <li><p>If <span title=concept-UQ-url-object>url object</span> is null,
 terminate these steps.

 <li><p>Set <span title=concept-UQ-url-object>url object</span>'s
 <span title=concept-UU-url>url</span>'s
 <span title=concept-URL-query>query</span> to the
 <span title=concept-urlencoded-serializer>serialization</span> of the
 <code>URLQuery</code> object's associated list of name-value pairs.

 <li><p>Run <span title=concept-UQ-url-object>url object</span>'s
 <span>pre-update steps</span>.
</ol>

<p>The
<dfn title=dom-URLQuery><code>URLQuery(<var title>init</var>)</code></dfn>
constructor must return a
<span title=concept-UQ-new>new <code>URLQuery</code> object</span> using
<var title>init</var> if given.

<p>The
<dfn title=dom-URLQuery-append><code>append(<var title>name</var>, <var title>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Append a new name-value pair whose name is <var title>name</var> and
 value is <var title>value</var>, to the list of name-value pairs.

 <li><p>Run the <span title=concept-UQ-update>update steps</span>.
</ol>

<p>The
<dfn title=dom-URLQuery-delete><code>delete(<var title>name</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>Remove all name-value pairs whose name is <var title>name</var>.

 <li><p>Run the <span title=concept-UQ-update>update steps</span>.
</ol>

<p>The
<dfn title=dom-URLQuery-get><code>get(<var title>name</var>)</code></dfn>
method must return the value of the first name-value pair whose name is
<var title>name</var>, and null if there is no such pair.

<p>The
<dfn title=dom-URLQuery-getAll><code>getAll(<var title>name</var>)</code></dfn>
method must return the values of all name-value pairs whose name is
<var title>name</var>, in list order, and the empty sequence otherwise.

<p>The
<dfn title=dom-URLQuery-set><code>set(<var title>name</var>, <var title>value</var>)</code></dfn>
method must run these steps:

<ol>
 <li><p>If there are any name-value pairs whose name is <var title>name</var>,
 set the value of the first such name-value pair to <var title>value</var> and remove the
 others.

 <li><p>Otherwise, append a new name-value pair whose name is
 <var title>name</var> and value is <var title>value</var>, to the list of
 name-value pairs.

 <li><p>Run the <span title=concept-UQ-update>update steps</span>.
</ol>

<p>The
<dfn title=dom-URLQuery-has><code>has(<var title>name</var>)</code></dfn>
method must return true if there is a name-value pair whose name is
<var title>name</var>, and false otherwise.




<h2 class=no-num>References</h2>
<div id=anolis-references></div>



<h2 class=no-num>Acknowledgments</h2>

<p>Thanks to
Adam Barth,
Alexandre Morgaut,
Bobby Holley,
Boris Zbarsky,
David Sheets,
Erik Arvidsson,
Gavin Carothers,
Geoff Richards,
Glenn Maynard,
Henri Sivonen,
Ian Hickson,
James Graham,
James Manger,
James Ross,
Marcos Cáceres,
Martin Dürst,
Mathias Bynens,
Michael™ Smith,
Peter Occil,
Rodney Rehm,
Simon Pieters,
Tab Atkins,
Tantek Çelik, and
成瀬ゆい (Yui Naruse)
for being awesome!

<!-- http://dvcs.w3.org/hg/url/raw-file/feb258fa6ab5/Overview.html -->

<p>While this standard has been written from scratch, special thanks should
be extended to the editors of the various specifications that previously
defined what we now call URLs:
Larry Masinter,
Martin Dürst,
Michel Suignard,
Roy Fielding, and
Tim Berners-Lee.

<!-- RFC 3986, RFC 3987 -->



<script id=head src=http://www.whatwg.org/specs/web-apps/current-work/dfn.js></script>
